---
import Tags from "~/components/widgets/Tags.astro";
import { getPosts } from "~/utils/getPostsCollection";

interface Props {
  count?: number;
}

const { count = 10 } = Astro.props;
const posts = await getPosts();
const latestPosts = posts.slice(0, count);
---

<section class="px-4 sm:px-6 pt-4 pb-12 mx-auto max-w-4xl overflow-x-hidden" aria-label="latest posts">
  <h2 class="text-2xl font-bold mb-6 text-slate-900 dark:text-slate-100 border-b border-slate-200 dark:border-slate-700 pb-3">
    Latest Posts
  </h2>

  <ul class="space-y-8">
    {latestPosts.map((post) => {
      const isEnglish = post.data.language === "en";
      return (
        <li class="group">
          <article class="flex flex-col sm:flex-row sm:items-baseline gap-2 sm:gap-6">
            <time
              datetime={post.data.pubDate.toISOString()}
              class="text-sm font-mono text-slate-500 dark:text-slate-400 shrink-0 tabular-nums"
            >
              {post.data.pubDate.toISOString().substring(0, 10)}
            </time>

            <div class="flex-grow">
              <h3 class="text-xl sm:text-2xl font-semibold leading-snug">
                <a
                  href={`/blog/${post.slug}`}
                  class="text-slate-900 dark:text-slate-100 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors duration-200"
                >
                  {post.data.title}
                </a>
              </h3>

              {post.data.description && (
                <p class="text-slate-600 dark:text-slate-400 text-sm mt-1 line-clamp-2">
                  {post.data.description}
                </p>
              )}

              <div class="mt-2 flex flex-wrap gap-2 items-center justify-center sm:justify-start">
                {/* Language tag - Brazil green/yellow for pt-br, blue/white for en */}
                <span class={`inline-flex items-center text-xs px-2 py-0.5 rounded-md font-medium ${
                  isEnglish
                    ? 'bg-blue-600 text-white dark:bg-blue-500'
                    : 'bg-green-600 text-yellow-300 dark:bg-green-700 dark:text-yellow-400'
                }`}>
                  {isEnglish ? "en" : "pt-br"}
                </span>
                {post.data.tags && post.data.tags.length > 0 && (
                  <Tags tags={post.data.tags.slice(0, 3)} size="xs" />
                )}
              </div>
            </div>
          </article>
        </li>
      );
    })}
  </ul>

  <div class="mt-10 text-center">
    <a
      href="/blog"
      class="inline-flex items-center gap-2 text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 font-medium transition-colors"
    >
      View all posts
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
      </svg>
    </a>
  </div>
</section>
