---
import Share from "~/components/widgets/Share.astro";
import Discussion from "~/components/widgets/Discussion.astro";
import GitHubComments from "~/components/widgets/GitHubComments.astro";
import ReactionCount from "~/components/widgets/ReactionCount.astro";
import Tags from "~/components/widgets/Tags.astro";
import TableOfContents from "~/components/widgets/TableOfContents.astro";
import SeriesInfo from "~/components/widgets/SeriesInfo.astro";
import SeriesNavigation from "~/components/widgets/SeriesNavigation.astro";
import RelatedPosts from "~/components/widgets/RelatedPosts.astro";
import Mermaid from "~/components/core/Mermaid.astro";
import type { TocHeading } from "~/utils/getTableOfContents";
import type { Post } from "~/utils/getPostsCollection";

const { post, image, toc = [], seriesPosts = [], relatedPosts = [] } = Astro.props;
const isEnglish = post.data.language === "en";
const classLanguage = isEnglish ? "en" : "br";
const showToc = toc && toc.length > 0;
const showSeries = post.data.series && seriesPosts.length > 1;
const showRelated = relatedPosts && relatedPosts.length > 0;
const showCommentsSection = post.data.showComments !== false; // Default to true unless explicitly disabled
---

<section class="py-8 sm:py-16 lg:py-20 mx-auto post">
  <article>
    <header>
      <p class="max-w-3xl mx-auto text-center">
         <span class={`font-mono block text-sm font-semibold uppercase ${classLanguage}`}>üìù {isEnglish ? "en" : "pt-br"}</span>
        <time datetime={post.data.pubDate.toISOString()} class="text-md font-mono">
          {post.data.pubDate.toISOString().substring(0, 10)}
        </time> ~ {post.readingTime} ~ {'‚òï'.repeat(post.coffeeCups)}
      </p>
      <h1
        class="px-4 sm:px-6 max-w-3xl mx-auto text-center text-5xl md:text-[3.50rem] font-bold leading-tighter tracking-tighter mb-6 md:mb-8 post-title-color"
      >
        {post.data.title}
      </h1>

      {post.data.tags && post.data.tags.length > 0 && (
        <div class="max-w-3xl mx-auto flex flex-col items-center gap-3 mb-6 not-prose">
          <Tags tags={post.data.tags} size="sm" centered={true} />
          {showCommentsSection && <ReactionCount language={isEnglish ? "en" : "pt"} />}
        </div>
      )}

        <Share post={post} />
    </header>
    <div
      class="container mx-auto px-4 sm:px-6 max-w-3xl prose prose-l lg:prose-l dark:prose-invert dark:prose-headings:text-slate-300 prose-md prose-headings:leading-tighter prose-headings:tracking-tighter prose-headings:font-bold prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-img:rounded-md prose-img:shadow-lg mt-8 font-serif"
    >
      {showSeries && <SeriesInfo currentPost={post} seriesPosts={seriesPosts} seriesName={post.data.series!} />}
      {showToc && <TableOfContents headings={toc} title={isEnglish ? "Table of Contents" : "√çndice"} />}
      <slot />
      {showSeries && <SeriesNavigation currentPost={post} seriesPosts={seriesPosts} seriesName={post.data.series!} />}
      {showRelated && <RelatedPosts posts={relatedPosts} currentPost={post} />}
    </div>
    <footer>
       <Share post={post} />
       <Discussion post={post} />
       {showCommentsSection && <GitHubComments language={isEnglish ? "en" : "pt"} />}
    </footer>
  </article>
  <Mermaid />
</section>
