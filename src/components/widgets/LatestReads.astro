---
import Tags from "~/components/widgets/Tags.astro";
import { getReads } from "~/utils/getReadsCollection";

interface Props {
  count?: number;
}

const { count = 3 } = Astro.props;
const reads = await getReads();
const latestReads = reads.slice(0, count);

// Type icons
const typeIcons: Record<string, string> = {
  article: 'ðŸ“„',
  paper: 'ðŸ“‘',
  book: 'ðŸ“š',
  newsletter: 'ðŸ“¬',
  thread: 'ðŸ§µ',
};
---

{latestReads.length > 0 && (
  <section class="px-4 sm:px-6 pt-4 pb-12 mx-auto max-w-4xl overflow-x-hidden" aria-label="latest reads">
    <h2 class="text-2xl font-bold mb-6 text-slate-900 dark:text-slate-100 border-b border-slate-200 dark:border-slate-700 pb-3 flex items-center gap-2">
      <span>ðŸ“–</span> What I Read
    </h2>

    <ul class="space-y-4">
      {latestReads.map((item) => {
        const typeIcon = typeIcons[item.data.type] || typeIcons.article;
        const linkUrl = item.data.sourceUrl || `/reads/${item.slug}`;
        const isExternal = !!item.data.sourceUrl;
        return (
          <li class="group">
            <a
              href={linkUrl}
              target={isExternal ? "_blank" : undefined}
              rel={isExternal ? "noopener noreferrer" : undefined}
              class="flex items-start gap-4 p-4 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors"
            >
              <span class="text-2xl flex-shrink-0">{typeIcon}</span>
              <div class="flex-grow min-w-0">
                <h3 class="font-semibold text-slate-900 dark:text-slate-100 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors inline-flex items-center gap-1">
                  {item.data.title}
                  {isExternal && (
                    <svg class="w-3.5 h-3.5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                    </svg>
                  )}
                </h3>
                {(item.data.author || item.data.source) && (
                  <p class="text-sm text-slate-500 dark:text-slate-400 mt-0.5">
                    {item.data.author && <span>{item.data.author}</span>}
                    {item.data.author && item.data.source && <span class="mx-1">Â·</span>}
                    {item.data.source && <span>{item.data.source}</span>}
                  </p>
                )}
              </div>
              <time
                datetime={item.data.pubDate.toISOString()}
                class="text-xs text-slate-400 dark:text-slate-500 flex-shrink-0"
              >
                {item.data.pubDate.toISOString().substring(0, 10)}
              </time>
            </a>
          </li>
        );
      })}
    </ul>

    <div class="mt-6 text-center">
      <a
        href="/reads"
        class="inline-flex items-center gap-2 text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 font-medium transition-colors text-sm"
      >
        View all reads
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
        </svg>
      </a>
    </div>
  </section>
)}
