---
import Picture from "~/components/core/Picture.astro";
import Tags from "~/components/widgets/Tags.astro";
import { findImage } from "~/utils/findImage";

const { post } = Astro.props;

const image = await findImage(post.data.image);

// Tech-themed emojis for posts without images
const techEmojis = [
  'ðŸ’»', 'ðŸš€', 'âš¡', 'ðŸ”§', 'ðŸŽ¯', 'ðŸ“±', 'ðŸŒ', 'â˜ï¸',
  'ðŸ”', 'ðŸ“Š', 'ðŸŽ¨', 'ðŸ§ ', 'ðŸ’¡', 'ðŸ”¥', 'âš™ï¸', 'ðŸŽ“',
  'ðŸ“š', 'ðŸ—ï¸', 'ðŸ§©', 'ðŸŽ­', 'ðŸ”¬', 'ðŸ“¡', 'ðŸ› ï¸', 'â­'
];

// Generate consistent emoji based on post slug (same post = same emoji)
const getEmojiForPost = (slug: string) => {
  let hash = 0;
  for (let i = 0; i < slug.length; i++) {
    hash = ((hash << 5) - hash) + slug.charCodeAt(i);
    hash = hash & hash; // Convert to 32bit integer
  }
  return techEmojis[Math.abs(hash) % techEmojis.length];
};

const fallbackEmoji = getEmojiForPost(post.slug);
---

<article
  class="max-w-md mx-auto md:max-w-none grid md:grid-cols-2 gap-6 md:gap-8"
>
  <a class="relative block group" href={`/blog/${post.slug}`}>
    <div
      class="relative h-64 md:h-80 overflow-hidden bg-gradient-to-br from-purple-500 to-blue-600 dark:from-purple-700 dark:to-blue-800 rounded shadow-lg flex items-center justify-center"
    >
      {image ? (
        <Picture
          src={image}
          class="absolute inset-0 w-full h-full object-cover rounded shadow-lg"
          widths={[400, 768]}
          sizes="(max-width: 767px) 400px, 768px"
          alt={post.data.description}
          aspectRatio={1}
        />
      ) : (
        <div class="text-9xl select-none" role="img" aria-label="Post icon">
          {fallbackEmoji}
        </div>
      )}
    </div>
  </a>
  <div>
    <header>
      <h2 class="text-xl sm:text-2xl font-bold leading-snug mb-2">
        <a
          class="text-slate-900 dark:text-slate-100 hover:text-blue-600 underline underline-offset-4 decoration-1 decoration-dotted transition ease-in duration-200"
          href={`/blog/${post.slug}`}
        >
          {post.data.title}
        </a>
      </h2>
    </header>
    <p class="text-md sm:text-lg flex-grow text-slate-700 dark:text-slate-300">
      {post.data.excerpt || post.data.description}
    </p>
    {post.data.tags && post.data.tags.length > 0 && (
      <div class="mt-3">
        <Tags tags={post.data.tags} size="xs" />
      </div>
    )}
    <footer class="flex items-center mt-4">
      <div>
        <span class="text-slate-600 dark:text-slate-400">
          <time datetime={post.data.pubDate.toISOString()}>
            {
              post.data.pubDate.toLocaleDateString("en-us", {
                year: "numeric",
                month: "short",
                day: "numeric",
              })
            }
          </time>
        </span>
      </div>
    </footer>
  </div>
</article>
